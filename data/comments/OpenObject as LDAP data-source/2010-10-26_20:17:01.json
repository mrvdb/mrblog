{
  "_id": "940370881",
  "_thread": "1430919137",
  "_parent": null,
  "name": "Simon Vass",
  "email": "svass@etech.ug",
  "message": "<p>Here is my latest combined sql file. I am trying to create a all in one file to make this simpler;</p><p>drop table ldap_oc_mappings cascade;<br>drop sequence ldap_oc_mappings_id_seq;<br>create table ldap_oc_mappings<br> (<br>        id serial not null primary key,<br>        name varchar(64) not null,<br>        keytbl varchar(64) not null,<br>        keycol varchar(64) not null,<br>        create_proc varchar(255),<br>        delete_proc varchar(255),<br>        expect_return int not null<br>);</p><p>drop table ldap_attr_mappings;<br>drop sequence ldap_attr_mappings_id_seq;<br>create table ldap_attr_mappings<br> (<br>        id serial not null primary key,<br>        oc_map_id integer not null references ldap_oc_mappings(id),<br>        name varchar(255) not null,<br>        sel_expr varchar(255) not null,<br>        sel_expr_u varchar(255),<br>        from_tbls varchar(255) not null,<br>        join_where varchar(255),<br>        add_proc varchar(255),<br>        delete_proc varchar(255),<br>        param_order int not null,<br>        expect_return int not null<br>);</p><p>drop table ldap_entries;<br>drop sequence ldap_entries_id_seq;<br>create table ldap_entries<br> (<br>        id serial not null primary key,<br>        dn varchar(255) not null,<br>        oc_map_id integer not null references ldap_oc_mappings(id),<br>        parent int NOT NULL,<br>        keyval int NOT NULL,<br>        UNIQUE ( oc_map_id, keyval ),<br>        UNIQUE ( dn )<br>);</p><p>drop table ldap_entry_objclasses;<br>create table ldap_entry_objclasses<br> (<br>        entry_id integer not null references ldap_entries(id),<br>        oc_name varchar(64)<br> );</p><p>INSERT INTO ldap_oc_mappings(name,keytbl,keycol,expect_return) VALUES('inetOrgPerson','ldap_inetOrgPerson','id',0);</p><p>INSERT INTO ldap_oc_mappings(name,keytbl,keycol,expect_return) VALUES('organizationalUnit','ldap_organizationalUnit','id',0);</p><p>/* DROP VIEW ldap_inetOrgPerson CASCADE; */<br>CREATE OR REPLACE VIEW ldap_inetorgperson AS<br>  SELECT <br>  <a href=\"http://a.id\" rel=\"nofollow noopener\" title=\"a.id\">a.id</a>,<br>  <a href=\"http://a.name\" rel=\"nofollow noopener\" title=\"a.name\">a.name</a> as cn,<br>  <a href=\"http://a.phone\" rel=\"nofollow noopener\" title=\"a.phone\">a.phone</a> AS telephonenumber,<br>  <a href=\"http://a.name\" rel=\"nofollow noopener\" title=\"a.name\">a.name</a> AS sn,<br>  <a href=\"http://a.name\" rel=\"nofollow noopener\" title=\"a.name\">a.name</a> AS givenname,<br>  a.fax AS facsimiletelephonenumber,<br>  <a href=\"http://a.mobile\" rel=\"nofollow noopener\" title=\"a.mobile\">a.mobile</a>, <br>  <a href=\"http://a.phone\" rel=\"nofollow noopener\" title=\"a.phone\">a.phone</a> AS homephone, <br>  lower(<a href=\"http://a.email\" rel=\"nofollow noopener\" title=\"a.email\">a.email</a>) AS mail, <br>  a.street, <br>  <a href=\"http://a.zip\" rel=\"nofollow noopener\" title=\"a.zip\">a.zip</a> AS postalcode<br>  FROM res_partner_address as a<br>  WHERE <br>    <a href=\"http://a.email\" rel=\"nofollow noopener\" title=\"a.email\">a.email</a>  IS NOT NULL AND <br>    a.type  =  'contact';</p><p>DROP TABLE ldap_organizationalUnit;<br>drop sequence ldap_organizationalUnit_id_seq;<br>CREATE TABLE ldap_organizationalUnit<br>(<br>    id serial NOT NULL,<br>    \"name\" character(255),<br>CONSTRAINT \"ldap_organizationalUnit_pkey\" PRIMARY KEY (id)<br>);</p><p>INSERT INTO ldap_organizationalUnit(name) VALUES ('addressbook');</p><p>INSERT INTO ldap_attr_mappings(oc_map_id,name,sel_expr,from_tbls,join_where,param_order,expect_return) VALUES(1,'telephoneNumber','telephoneNumber','ldap_inetOrgPerson','1=1',3,0);</p><p>/* drop view ldap_entries;*/<br>CREATE OR REPLACE VIEW ldap_entries AS <br>   SELECT <br>     0 AS id, <br>     'ou=addressbook,dc=fbwgroup,dc=local' AS dn, <br>     2 AS oc_map_id, <br>     0 AS parent, <br>     0 AS keyval<br>    UNION <br>   SELECT <br>     <a href=\"http://ldap_inetorgperson.id\" rel=\"nofollow noopener\" title=\"ldap_inetorgperson.id\">ldap_inetorgperson.id</a>, <br>     ('cn=' || <a href=\"http://ldap_inetorgperson.cn\" rel=\"nofollow noopener\" title=\"ldap_inetorgperson.cn\">ldap_inetorgperson.cn</a>) || <br>     ',ou=addressbook,dc=fbwgroup,dc=local' AS dn, <br>     1 AS oc_map_id, <br>     0 AS parent, <br>     <a href=\"http://ldap_inetorgperson.id\" rel=\"nofollow noopener\" title=\"ldap_inetorgperson.id\">ldap_inetorgperson.id</a> AS keyval<br>   FROM ldap_inetorgperson;</p>",
  "date": "2010-10-26T20:17:01Z",
  "ip": "41.210.162.90",
  "spam": "false",
  "deleted": "false"
}
